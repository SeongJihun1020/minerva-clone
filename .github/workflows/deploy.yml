name: Auto Deploy (Self-hosted Runner)

on:
  push:
    branches: ["main"]

jobs:
  deploy:
    runs-on: self-hosted

    steps:
    - name: Checkout Repo
      uses: actions/checkout@v3

    - name: Move to project folder
      run: |
        cd /var/www/minerva-clone
        echo "Current directory: $(pwd)"

    - name: Git Pull (fetch latest code)
      run: |
        cd /var/www/minerva-clone
        git pull origin main

    - name: Install Node modules
      run: |
        cd /var/www/minerva-clone
        npm install

    - name: Build Project
      run: |
        cd /var/www/minerva-clone
        npm run build

    - name: Deploy to NGINX folder
      run: |
        rm -rf /var/www/html/*
        cp -r /var/www/minerva-clone/dist/* /var/www/html/
        echo "Deployment completed!"
